<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>scarf-seams</title>
  <script type="module" crossorigin>
var F=Object.defineProperty;var Z=(i,e,t)=>e in i?F(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>(Z(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const w={rapidMove:"G0",linearMove:"G1",cwArc:"G2",ccwArc:"G3",home:"G28",absolute:"G90",relative:"G91",setPosition:"G92",resetPositionToNative:"G92.1",eAbsolute:"M82",eRelative:"M83"};Object.fromEntries(Object.entries(w).map(([i,e])=>[i,(t,...n)=>{const o=String.raw(t,...n);return`${e} ${o}`}]));const R=Object.values(w);function q(i){if(i.startsWith(";"))return{type:"comment",comment:i.slice(1)};const e=j(i);if(e!=null){const t=e,[n,...o]=i.split(";"),s=n.trim().split(/\s+/),r={};for(const c of s.slice(1)){const u=c[0],a=Number(c.slice(1));r[u]=a}return t==="G92.1"&&(r.X=0,r.Y=0,r.Z=0),{type:"simple",command:t,args:r,comment:o.join(";")}}return{type:"unknown",content:i}}function L(i){switch(i.type){case"comment":return N(i);case"simple":return D(i);case"unknown":return I(i)}}const $=/^\s*([A-Z][0-9.]+)\b/;function j(i){const e=i.match($);return!e||!R.includes(e[1])?null:e[1]}function N(i){return`;${i.comment}`}function I(i){return i.content}function D(i){const e=Object.entries(i.args??{}).map(([t,n])=>{let o;switch(t){case"X":case"Y":case"Z":o=3;break;case"E":o=5;break;default:o=0}return`${t}${n.toFixed(o)}`});return`${i.command} ${e.join(" ")}${i.comment?`;${i.comment}`:""}`}const X=[w.linearMove,w.rapidMove];function E(i){return i.type==="simple"&&X.includes(i.command)}function H(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=Array.from(typeof i=="string"?[i]:i);n[n.length-1]=n[n.length-1].replace(/\r?\n([\t ]*)$/,"");var o=n.reduce(function(c,u){var a=u.match(/\n([\t ]+|(?!\s).)/g);return a?c.concat(a.map(function(l){var m,p;return(p=(m=l.match(/[\t ]/g))===null||m===void 0?void 0:m.length)!==null&&p!==void 0?p:0})):c},[]);if(o.length){var s=new RegExp(`
[	 ]{`+Math.min.apply(Math,o)+"}","g");n=n.map(function(c){return c.replace(s,`
`)})}n[0]=n[0].replace(/^\r?\n/,"");var r=n[0];return e.forEach(function(c,u){var a=r.match(/(?:^|\n)( *)$/),l=a?a[1]:"",m=c;typeof c=="string"&&c.includes(`
`)&&(m=String(c).split(`
`).map(function(p,h){return h===0?p:""+l+p}).join(`
`)),r+=m+n[u+1]}),r}class f{constructor(e,t,n){d(this,"x");d(this,"y");d(this,"z");this.x=e,this.y=t,this.z=n}clone(){return new f(this.x,this.y,this.z)}get length(){return 3}distanceTo(e){return((this.x-e.x)**2+(this.y-e.y)**2+(this.z-e.z)**2)**.5}subtract(e){return[this.x-e.x,this.y-e.y,this.z-e.z]}addVector(e){return new f(this.x+e[0],this.y+e[1],this.z+e[2])}toVector(){return[this.x,this.y,this.z]}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)}get[Symbol.toStringTag](){return`{${this.x}, ${this.y}, ${this.z}}`}static get unknown(){return new f(1/0,1/0,1/0)}static get zero(){return new f(0,0,0)}}function K(i){return i.reduce((e,t)=>e+t**2,0)**.5}function b(i,e){return i.map(t=>t*e)}function T(i){return b(i,1/K(i))}class v{constructor(){d(this,"positionMode","absolute");d(this,"extrusionMode","relative");d(this,"logicalPosition",f.unknown);d(this,"extrusion",0);d(this,"feedRate",0);d(this,"didExtrudeOnLastMove",!1);d(this,"physicalOffset",f.zero);d(this,"physicalEOffset",0)}get logicalPositionKnown(){return this.logicalPosition.isFinite()}get physicalPosition(){if(!this.logicalPositionKnown)throw new Error(H`
          Cannot get physical position when logical position is unknown.
          The gcode may have called G92 (set position) while the logical
          position was unknown, either before homing or after an arc command.
        `);return this.logicalPosition.addVector(this.physicalOffset.toVector())}get physicalExtrusion(){return this.extrusion+this.physicalEOffset}executeLine(e){const t=q(e);return this.executeCommand(t)}executeCommand(e){switch(e.type){case"simple":return this.executeSimpleCommand(e);case"comment":return this;case"unknown":return this}}executeSimpleCommand(e){const t=this._rawExecuteSimpleCommand(e);return E(e)&&(t.didExtrudeOnLastMove=t.extrusion>this.extrusion),t}_rawExecuteSimpleCommand(e){switch(e.command){case"G0":case"G1":return this.executeMoveCommand(e);case"G2":case"G3":return this.executeArcCommand();case"G28":return this.executeHomeCommand(e);case"G90":return this.executeSetPositionModeCommand(e);case"G91":return this.executeSetPositionModeCommand(e);case"G92":case"G92.1":return this.executeSetPositionCommand(e);case"M82":return this.executeSetExtrusionModeCommand(e);case"M83":return this.executeSetExtrusionModeCommand(e)}}executeSetExtrusionModeCommand(e){const t=this.clone();switch(e.command){case"M82":t.extrusionMode="absolute";break;case"M83":t.extrusionMode="relative";break}return t}executeSetPositionCommand(e){const{args:t}=e,n=this.clone();for(const o of["x","y","z"]){const s=o.toUpperCase();if(s in t){const r=t[s],c=r-this.logicalPosition[o];n.physicalOffset[o]=this.physicalOffset[o]-c,n.logicalPosition[o]=r}}if("E"in t){const o=t.E,s=o-this.extrusion;n.physicalEOffset=this.physicalEOffset-s,n.extrusion=o}return n}executeSetPositionModeCommand(e){const t=this.clone();switch(e.command){case"G90":t.positionMode="absolute";break;case"G91":t.positionMode="relative";break}return t}executeHomeCommand(e){const{args:t}=e;if("0"in t)throw new Error("G28 0 is not supported; VM cannot determine 'trusted' axes");const n=this.clone();let o=!1;for(const s of["x","y","z"])s.toUpperCase()in t&&(o=!0,n.physicalOffset[s]=0,n.logicalPosition[s]=0);return o||(n.physicalOffset=f.zero,n.logicalPosition=f.zero),n}executeArcCommand(){const e=this.clone();return e.logicalPosition.x=1/0,e.logicalPosition.y=1/0,e}executeMoveCommand(e){const t=this.clone(),{args:n}=e;switch(this.positionMode){case"absolute":t.logicalPosition=new f(n.X??this.logicalPosition.x,n.Y??this.logicalPosition.y,n.Z??this.logicalPosition.z);break;case"relative":t.logicalPosition=this.logicalPosition.addVector([n.X??0,n.Y??0,n.Z??0]);break}switch(this.extrusionMode){case"absolute":t.extrusion=n.E??this.extrusion;break;case"relative":t.extrusion+=n.E??0;break}return t}convertPhysicalPositionToLogical(e){return e.addVector(b(this.physicalOffset.toVector(),-1))}clone(){const e=Object.assign(new v,this);return e.logicalPosition=this.logicalPosition.clone(),e.physicalOffset=this.physicalOffset.clone(),e}}function Y(i){return new U(i).process()}const B=1/3;class k extends Error{constructor(){super("Coordinate system change in taper section")}}class U{constructor(e){d(this,"params");d(this,"currentPosition");d(this,"minSafeZ",0);d(this,"currentMode","absolute");d(this,"inputGcodeLines",[]);d(this,"outputGcodeLines",[]);d(this,"inputStack",[]);this.currentPosition=new f(1/0,1/0,1/0),this.params=e,this.inputGcodeLines=this.params.gcode.split(`
`)}get gapFraction(){return this.params.seamGap/this.params.overlap}process(){this.findMinimumSafeZ();let e=new v;this.inputStack=[];for(const t of this.inputGcodeLines)this.inputStack.push(q(t));for(this.inputStack.reverse();;){const t=this.inputStack.pop();if(!t)break;if(this.isExtrusionStart(e,t)){const n=this.nextExtrusionSequence(e,t);for(const o of n)e=e.executeCommand(o),this.outputGcodeLines.push(L(o))}else e=e.executeCommand(t),this.outputGcodeLines.push(L(t))}return this.outputGcodeLines.join(`
`)}nextExtrusionSequence(e,t){const n=this.consumeWhileExtruding(e,t);if(!this.isLoop(e,n))return n;const o=this.calculateSequenceLength(e,n);if(o<this.params.taperResolution)return n;const s=Math.min(this.params.overlap,B*o);try{return this.createOverlappedSequence({vm:e,originalExtrusionSequence:n,overlap:s})}catch(r){if(r instanceof k)return console.warn(r),console.warn("Passthrough for loop with illegal move inside taper"),n;throw r}}createOverlappedSequence({vm:e,originalExtrusionSequence:t,overlap:n}){const{taperSection:o,nonTaperSection:s}=this.splitTaperSection({vm:e,sequence:t,overlap:n}),r=this.divideSequence(e,o,this.params.taperResolution),c=this.makeStartingTaper(e,r,n);for(const a of[...c,...s])e=e.executeCommand(a);const u=this.makeEndingTaper(e,r,n);return[{type:"comment",comment:"Beginning of tapered loop"},...c,...s,...u,{type:"comment",comment:"End of tapered loop"}]}divideSequence(e,t,n){const o=[];for(const s of t){const r=e.executeCommand(s);if(!E(s)){e=r,o.push(s);continue}const c=this.divideMove(e,s,n);o.push(...c),e=r}return o}divideMove(e,t,n){const o=e.executeCommand(t),s=[{type:"comment",comment:"Beginning of divided move"}],r=e.physicalPosition,c=o.physicalPosition,u=r.distanceTo(c),a=Math.ceil(u/n),l=u/a,m=b(T(c.subtract(r)),l),p=(o.extrusion-e.extrusion)/a;for(let h=0;h<a;h++){const P=r.addVector(b(m,h)),x=e.convertPhysicalPositionToLogical(P),g={...t,args:{...t.args,X:x.x,Y:x.y,Z:x.z,E:p}};s.push(g)}return s.push({type:"comment",comment:"End of divided move"}),s}makeStartingTaper(e,t,n){let o=e.physicalPosition,s=0;const r=n*(1-this.gapFraction),c=n-r;return t.map(u=>{const a=e.executeCommand(u);if(!E(u))return e=a,u;const l=a.physicalPosition;s+=o.distanceTo(l),o=l;const m=Math.max((s-c)/r,0),p=m*(a.extrusion-e.extrusion),h=(1-m)*this.params.layerHeight,P=Math.max(a.physicalPosition.z-h,this.minSafeZ),x=new f(l.x,l.y,P),g=e.convertPhysicalPositionToLogical(x),S={...u,args:{...u.args,Z:g.z,E:p*this.params.extrusionFactor}};return e=a,S})}makeEndingTaper(e,t,n){let o=e.physicalPosition,s=0;const r=n*(1-this.gapFraction),c=[];for(const u of t){const a=e.executeCommand(u);if(!E(u)){if(u.type==="simple")switch(u.command){case w.setPosition:case w.relative:case w.home:throw new k}e=a;continue}const l=a.physicalPosition;s+=o.distanceTo(l),o=l;const p=(1-Math.min(s/r,1))*(a.extrusion-e.extrusion),h={...u,args:{...u.args,E:p*this.params.extrusionFactor}};c.push(h),e=a}return c}splitTaperSection({vm:e,sequence:t,overlap:n}){let o=0,s=e.physicalPosition;const r=[],c=[];let u=!0;for(const a of t){const l=e.executeCommand(a);if(u){if(!E(a)){r.push(a);continue}const m=l.physicalPosition,p=s.distanceTo(m);if(o+p<n)o+=p,r.push(a);else{u=!1;const h=n-o,P=T(m.subtract(s)),x=s.addVector(b(P,h)),g=l.extrusion-e.extrusion,S=h/p,M=g*S,G=g-M,C=e.convertPhysicalPositionToLogical(x),O={type:"simple",command:a.command,args:{...a.args,X:C.x,Y:C.y,Z:C.z,E:M}};r.push(O);const y={...a,args:{...a.args,E:G}};c.push(y)}s=m,e=l}else c.push(a),e=l}return{taperSection:r,nonTaperSection:c}}isLoop(e,t){if(!e.logicalPositionKnown)return!1;const n=e.physicalPosition;for(const s of t)e=e.executeCommand(s);return e.physicalPosition.distanceTo(n)<this.params.loopTolerance}calculateSequenceLength(e,t){let n=e.physicalPosition,o=0;for(const s of t){e=e.executeCommand(s);const r=e.physicalPosition,c=n.distanceTo(r);o+=c,n=r}return o}consumeWhileExtruding(e,t){const n=[t];let o=e.executeCommand(t);for(;;){const s=this.inputStack.pop();if(!s)break;if(o=o.executeCommand(s),o.didExtrudeOnLastMove)n.push(s);else{this.inputStack.push(s);break}}return n}isExtrusionStart(e,t){return e.executeCommand(t).extrusion>e.extrusion}findMinimumSafeZ(){let e=new v;for(const t of this.inputGcodeLines)e=e.executeLine(t),e.logicalPositionKnown&&(this.minSafeZ=Math.min(this.minSafeZ,e.physicalPosition.z));if(!Number.isFinite(this.minSafeZ))throw new Error("Could not find minimum safe Z coordinate")}}const z=document.querySelector("#process-form");z&&z.addEventListener("submit",async i=>{var e,t,n,o,s,r;try{i.preventDefault();const c=document.querySelector("#layer-height"),u=document.querySelector("#overlap"),a=document.querySelector("#choose-file"),l=document.querySelector("#loop-tolerance"),m=document.querySelector("#taper-resolution"),p=document.querySelector("#seam-gap"),h=document.querySelector("#extrusion-factor"),P=c.valueAsNumber,x=u.valueAsNumber,g=l.valueAsNumber,S=m.valueAsNumber,M=p.valueAsNumber,G=await W(a),C=h.valueAsNumber,O=Y({gcode:G,layerHeight:P,overlap:x,loopTolerance:g,taperResolution:S,seamGap:M,extrusionFactor:C});(t=(e=document.querySelector("#download-button"))==null?void 0:e.remove)==null||t.call(e);const y=document.createElement("a");y.style.marginLeft="1em";const A=Object.assign(document.createElement("button"),{textContent:"Download GCode",type:"button"});y.appendChild(A),y.id="download-button",y.download=`${((o=(n=a.files)==null?void 0:n[0])==null?void 0:o.name)??"unknown"}-processed.gcode`;const V=new Blob([O],{type:"text/plain"});y.href=URL.createObjectURL(V),(r=(s=document.querySelector("#process-button"))==null?void 0:s.after)==null||r.call(s,y)}catch(c){window.alert(c),console.error(c)}});function W(i){return new Promise((e,t)=>{var s;const n=(s=i.files)==null?void 0:s[0];if(!n){t(new Error("No file selected"));return}const o=new FileReader;o.onload=()=>{e(o.result)},o.onerror=()=>{t(o.error)},o.readAsText(n)})}

</script>
  <style>
:root{--active-brightness: .85;--border-radius: 5px;--box-shadow: 2px 2px 10px;--color-accent: #118bee15;--color-bg: #fff;--color-bg-secondary: #e9e9e9;--color-link: #118bee;--color-secondary: #920de9;--color-secondary-accent: #920de90b;--color-shadow: #f4f4f4;--color-table: #118bee;--color-text: #000;--color-text-secondary: #999;--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;--hover-brightness: 1.2;--justify-important: center;--justify-normal: left;--line-height: 1.5;--width-card: 285px;--width-card-medium: 460px;--width-card-wide: 800px;--width-content: 1080px}@media (prefers-color-scheme: dark){:root[color-mode=user]{--color-accent: #0097fc4f;--color-bg: #333;--color-bg-secondary: #555;--color-link: #0097fc;--color-secondary: #e20de9;--color-secondary-accent: #e20de94f;--color-shadow: #bbbbbb20;--color-table: #0097fc;--color-text: #f7f7f7;--color-text-secondary: #aaa}}html{scroll-behavior:smooth}@media (prefers-reduced-motion: reduce){html{scroll-behavior:auto}}article aside{background:var(--color-secondary-accent);border-left:4px solid var(--color-secondary);padding:.01rem .8rem}body{background:var(--color-bg);color:var(--color-text);font-family:var(--font-family);line-height:var(--line-height);margin:0;overflow-x:hidden;padding:0}footer,header,main{margin:0 auto;max-width:var(--width-content);padding:3rem 1rem}hr{background-color:var(--color-bg-secondary);border:none;height:1px;margin:4rem 0;width:100%}section{display:flex;flex-wrap:wrap;justify-content:var(--justify-important)}section img,article img{max-width:100%}section pre{overflow:auto}section aside{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);margin:1rem;padding:1.25rem;width:var(--width-card)}section aside:hover{box-shadow:var(--box-shadow) var(--color-bg-secondary)}[hidden]{display:none}article header,div header,main header{padding-top:0}header{text-align:var(--justify-important)}header a b,header a em,header a i,header a strong{margin-left:.5rem;margin-right:.5rem}header nav img{margin:1rem 0}section header{padding-top:0;width:100%}nav{align-items:center;display:flex;font-weight:700;justify-content:space-between;margin-bottom:7rem}nav ul{list-style:none;padding:0}nav ul li{display:inline-block;margin:0 .5rem;position:relative;text-align:left}nav ul li:hover ul{display:block}nav ul li ul{background:var(--color-bg);border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);display:none;height:auto;left:-2px;padding:.5rem 1rem;position:absolute;top:1.7rem;white-space:nowrap;width:auto;z-index:1}nav ul li ul:before{content:"";position:absolute;left:0;right:0;top:-.5rem;height:.5rem}nav ul li ul li,nav ul li ul li a{display:block}code,samp{background-color:var(--color-accent);border-radius:var(--border-radius);color:var(--color-text);display:inline-block;margin:0 .1rem;padding:0 .5rem}details{margin:1.3rem 0}details summary{font-weight:700;cursor:pointer}h1,h2,h3,h4,h5,h6{line-height:var(--line-height)}mark{padding:.1rem}ol li,ul li{padding:.2rem 0}p{margin:.75rem 0;padding:0;width:100%}pre{margin:1rem 0;max-width:var(--width-card-wide);padding:1rem 0}pre code,pre samp{display:block;max-width:var(--width-card-wide);padding:.5rem 2rem;white-space:pre-wrap}small{color:var(--color-text-secondary)}sup{background-color:var(--color-secondary);border-radius:var(--border-radius);color:var(--color-bg);font-size:xx-small;font-weight:700;margin:.2rem;padding:.2rem .3rem;position:relative;top:-2px}a{color:var(--color-link);display:inline-block;font-weight:700;text-decoration:underline}a:active{filter:brightness(var(--active-brightness))}a:hover{filter:brightness(var(--hover-brightness))}a b,a em,a i,a strong,button,input[type=submit]{border-radius:var(--border-radius);display:inline-block;font-size:medium;font-weight:700;line-height:var(--line-height);margin:.5rem 0;padding:1rem 2rem}button,input[type=submit]{font-family:var(--font-family)}button:active,input[type=submit]:active{filter:brightness(var(--active-brightness))}button:hover,input[type=submit]:hover{cursor:pointer;filter:brightness(var(--hover-brightness))}a b,a strong,button,input[type=submit]{background-color:var(--color-link);border:2px solid var(--color-link);color:var(--color-bg)}a em,a i{border:2px solid var(--color-link);border-radius:var(--border-radius);color:var(--color-link);display:inline-block;padding:1rem 2rem}article aside a{color:var(--color-secondary)}figure{margin:0;padding:0}figure img{max-width:100%}figure figcaption{color:var(--color-text-secondary)}button:disabled,input:disabled{background:var(--color-bg-secondary);border-color:var(--color-bg-secondary);color:var(--color-text-secondary);cursor:not-allowed}button[disabled]:hover,input[type=submit][disabled]:hover{filter:none}form{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);display:block;max-width:var(--width-card-wide);min-width:var(--width-card);padding:1.5rem;text-align:var(--justify-normal)}form header{margin:1.5rem 0;padding:1.5rem 0}input,label,select,textarea{display:block;font-size:inherit;max-width:var(--width-card-wide)}input[type=checkbox],input[type=radio]{display:inline-block}input[type=checkbox]+label,input[type=radio]+label{display:inline-block;font-weight:400;position:relative;top:1px}input[type=range]{padding:.4rem 0}input,select,textarea{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);margin-bottom:1rem;padding:.4rem .8rem}input[type=text],textarea{width:calc(100% - 1.6rem)}input[readonly],textarea[readonly]{background-color:var(--color-bg-secondary)}label{font-weight:700;margin-bottom:.2rem}dialog{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:50%;z-index:999}table{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);border-spacing:0;display:inline-block;max-width:100%;overflow-x:auto;padding:0;white-space:nowrap}table td,table th,table tr{padding:.4rem .8rem;text-align:var(--justify-important)}table thead{background-color:var(--color-table);border-collapse:collapse;border-radius:var(--border-radius);color:var(--color-bg);margin:0;padding:0}table thead th:first-child{border-top-left-radius:var(--border-radius)}table thead th:last-child{border-top-right-radius:var(--border-radius)}table thead th:first-child,table tr td:first-child{text-align:var(--justify-normal)}table tr:nth-child(2n){background-color:var(--color-accent)}blockquote{display:block;font-size:x-large;line-height:var(--line-height);margin:1rem auto;max-width:var(--width-card-medium);padding:1.5rem 1rem;text-align:var(--justify-important)}blockquote footer{color:var(--color-text-secondary);display:block;font-size:small;line-height:var(--line-height);padding:1.5rem 0}*{scrollbar-width:thin;scrollbar-color:rgb(202,202,232) auto}*::-webkit-scrollbar{width:5px;height:5px}*::-webkit-scrollbar-track{background:transparent}*::-webkit-scrollbar-thumb{background-color:#cacae8;border-radius:10px}

</style>
</head>

<body>
  <main>
    <h1>scarf-seams</h1>
    <h2>Warning</h2>
    <p>
      This is an experimental tool in a pre-release state. Post-processing gcode
      is complicated, and bugs could cause your printer to try to move your
      nozzle out of bounds (including crashing into the print bed). The code
      attempts to protect against these cases, but there is no substitute for
      examining the output gcode in a gcode previewer before printing. <strong>Use
        at your own risk.</strong>
    <h2> Purpose </h2>
    <p> There has been some experimentation recently with hiding seems with 3D
      printing. <a href="https://github.com/vgdh/seam-hiding-whitepaper" target="_blank">This repo</a> and
      <a href="https://github.com/prusa3d/PrusaSlicer/issues/11621" target="_blank">this PrusaSlicer pull request</a>
      discuss the
      technique, and provide examples using custom generated gcode. However, these
      examples only allow creating a cylinder.
    </p>
    <p>
      This tool will allow you to load an arbitrary (see requirements below)
      gcode file and apply the technique to it.
    </p>
    </p>
    <form id="process-form">
      <label for="layer-height">Layer Height</label><input type="number" id="layer-height" value="0.2" step="0.01">
      <label for="overlap">Overlap Distance (mm)</label><input type="number" id="overlap" value="6">
      <label for="seam-gap">Seam Gap (mm)</label><input type="number" id="seam-gap" value="0.00" step="0.01">
      <label for="extrusion-factor">Extrusion Factor</label><input type="number" id="extrusion-factor" value=".9"
        step="0.01">
      <label for="choose-file">Choose a gcode file:</label>
      <input type="file" id="choose-file" accept=".gcode" />
      <button type="submit" id="process-button">Process</button>
      <h3>Advanced</h3>
      <label for="loop-tolerance">Loop Tolerance (mm)</label><input type="number" id="loop-tolerance" value="0.1"
        step="0.01">
      <label for="taper-resolution">Taper resolution (mm)</label><input type="number" id="taper-resolution" value="0.1"
        step="0.01">
    </form>
    <h2>Requirements</h2>
    <p>
      Your gcode file must meet the following requirements:
    </p>
    <ul>
      <li>Marlin gcode</li>
      <li>Absolute positioning for the XYZ coordinates (this is very typical)</li>
      <li>Relative positioning for extruder (also typical)</li>
      <li>No arc moves during actual printing. (You may need to turn off "arc
        fitting" or similar in your slicer)</li>
      <li>Fixed layer height (which should match the layer height you set in the
        form above)</li>
      <li>No "seam gap" in the original gcode. This setting is often set by
        default to avoid extra material building up at the seams, but it
        interferes with loop detection. You should set it to zero in your slicer.</li>
    </ul>
    <p>
      In some cases, the tool will detect these issues and alert you. In other
      cases, code where the requirements are not met will simply be skipped
      over. <strong>Always use a slicer or similar tool with a gcode preview to
        verify the output file.</strong>
    </p>
    <h2>Parameters</h2>
    <p>
      <strong>Layer Height</strong> - The layer height of your print. This should
      match the layer height used in your slicer.
    </p>
    <p>
      <strong>Overlap Distance</strong> - The distance to overlap the ends of
      each loop.
    </p>
    <p>
      <strong>Seam Gap</strong> - A fudge factor for preventing zits around the
      seams. This will end the taper early so that an excess of material doesn't
      build up. The correct value will depend on your printer.
    </p>
    <p>
      <strong>Extrusion Factor</strong> - Another fudge factor to reduce
      effective overextrusion or underextrusion. This will scale the extrusion amount in the
      overlap region.
    </p>
    <p>
      <strong>Loop Tolerance</strong> - The maximum distance between the start
      and end of a loop. If you can't turn off the "seam gap" setting in your
      slicer, you can compensate it by increasing this value. Note that this may
      cause artifacts in some cases by incorrectly identifying small,
      intentional gaps as loop ends.
    </p>
    <p>
      <strong>Taper Resolution</strong> - The size of the steps in the taper
      sections which ramp up extrusion and Z height. The smaller this is, the
      larger your output gcode will be. Theoretically, you could set this so low
      that your printer would struggle to read the gcode fast enough during
      printing. Larger values may cause noticeable stair-stepping. You probably
      don't need to change this setting.
  </main>
</body>

</html>